<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OCB Stays - Food Menu</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    .menu-category {
      margin-top: 2rem;
    }
    .item-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0;
      border-bottom: 1px solid #eee;
    }
  </style>
</head>
<body class="bg-light">
  <div class="container py-5">
    <h1 class="mb-4">üçΩÔ∏è OCB Stays ‚Äì Food Menu</h1>
    <p class="text-muted mb-4">Select items below. Orders will be delivered to your room.</p>
    <h5 id="roomHeader" class="text-primary mb-4"></h5>

    <div id="menuContainer"></div>

    <div class="mt-4">
      <label for="instructions" class="form-label">Special Instructions</label>
      <textarea id="instructions" class="form-control" rows="3"></textarea>
    </div>

    <button id="placeOrderBtn" class="btn btn-success mt-4">Place Order</button>

    <div id="confirmationMsg" class="alert alert-success mt-4 d-none">
      ‚úÖ Order placed successfully!
    </div>
  </div>

  <script>
    const SHEET_URL = 'https://script.google.com/macros/s/YOUR_DEPLOYED_WEB_APP_URL/exec'; // Replace with your Apps Script web app URL
    const params = new URLSearchParams(window.location.search);
    const room = params.get('room') || '';
    document.getElementById('roomHeader').textContent = `Room: ${room}`;

    async function loadMenu() {
      const res = await fetch(`${SHEET_URL}?type=menu`);
      const data = await res.json();
      const grouped = {};

      data.forEach(item => {
        if (item.Available === 'Yes') {
          if (!grouped[item.Category]) grouped[item.Category] = [];
          grouped[item.Category].push(item);
        }
      });

      const container = document.getElementById('menuContainer');
      for (const category in grouped) {
        const section = document.createElement('div');
        section.className = 'menu-category';
        section.innerHTML = `<h4>${category}</h4>`;

        grouped[category].forEach(item => {
          const row = document.createElement('div');
          row.className = 'item-row';
          row.innerHTML = `
            <div>
              <div><strong>${item.Item}</strong></div>
              <div class="text-muted small">‚Çπ${item["Price (‚Çπ)"]}</div>
            </div>
            <button class="btn btn-outline-primary btn-sm" onclick="addItem('${item.Item}', ${item["Price (‚Çπ)"]})">Add</button>
          `;
          section.appendChild(row);
        });

        container.appendChild(section);
      }
    }

    const cart = [];
    function addItem(name, price) {
      cart.push({ name, price });
      alert(`${name} added to order.`);
    }

    document.getElementById('placeOrderBtn').addEventListener('click', async () => {
      const instructions = document.getElementById('instructions').value;
      const res = await fetch(`${SHEET_URL}?type=order`, {
        method: 'POST',
        body: JSON.stringify({ room, cart, instructions })
      });

      if (res.ok) {
        document.getElementById('confirmationMsg').classList.remove('d-none');
      }
    });

    loadMenu();
  </script>
</body>
</html>
